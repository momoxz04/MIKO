<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="stylesheet.css">
  <title> LOGIN </title>
</head>
<body>

  <header>
    <nav>

      <a href="index.html"><img id="logo"src="img/logo_miko.png"></a>
      <a href="Login.html"><li> Login </li></a>
        <a href="json.html"><li> JSON </li></a>
        <a href="aboutus.html"><li> About Us </li></a>

    </nav>

  </header>
  <main id="loginmain">
  <h1> Login </h1>
  <form>
    <div class="container">
      <div>
        <label>Username : </label>
        <input id="username" type="text" placeholder="Enter Username" name="username" required>
      </div>
      <div>
        <label>Password : </label>
        <input id="password" type="password" placeholder="Enter Password" name="password" required>
        <p id="passwordStrength">Password strength: </p>
      </div>
      <button id="submit" type="submit">Login</button>
      <div id="calcBox">
        <label>Calculation : <span id="calculation"></span></label>
        <input id="calcInput" type="text" placeholder="Enter result" name="calc" required>
      </div>
      <p>Validation:</p>
      <div id="output" style="color: red;"></div>
    </div>
  </form>
</main>
  </body>
  <footer>
    this is a placeholder for now
  </footer>

<script>
  // Initialise variables
  var button = document.querySelector('#submit'); // Select the submit button by id
  button.disabled = true; // Disables the button by default.
  button.style.display = 'none';
  var output = document.querySelector('#output');
  var inputUsername = document.querySelector('#username'); // Selects the username input by the DOM
  var inputPassword = document.querySelector('#password'); // Selects the password inut by the DOM
  var passwordStrength = document.querySelector('#passwordStrength'); // Selects password strength

  var calcInput = document.querySelector('#calcInput'); // Selects calculation input
  var calculation = document.querySelector('#calculation'); // Selects calculation text
  var calcBox = document.querySelector('#calcBox'); // Selects calculation container

  // Regular expression for email: (3+ chars) + @ + (3+ chars) + dot + (2-3 chars)
  const regexUsername = /^[a-zA-Z0-9]{3,}@[a-zA-Z0-9]{3,}.[a-zA-Z]{2,3}$/;
  // Regular expression for password: (3+ chars) + @ + (3+ chars) + dot + (2-3 chars)
  const regexHasEightChars = /^(?=^.{8,}$).*$/;
  const regexPassword = /^(?=^.{12,}$)(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])(?=.*[^A-Za-z0-9]).*$/;

  // Initialise calculation
  const a = Math.floor(Math.random() * (100 - 1) + 1);
  const b = Math.floor(Math.random() * (100 - 1) + 1);
  calculation.innerHTML = a + ' + ' + b + ' = '

  // Listens to any inputs and calls the validateInputs() methode.
  document.addEventListener('keyup', function (event) {
    button.disabled = validateInputs();
    validatePassword();
    checkCalculation()
  });


  // Using a reverse validation. It always return false (not invalid) until something is invalid (true).
  function validateInputs() {
    let invalid = false;
    let message = '';
    // Checks if both input length are higher than 3 letters
    if (inputUsername.value.length < 3 || inputPassword.value.length < 3) {
      message += '<p>Username and password has to have at least 3 letters!</p>';
      invalid = true;
    }
    // Checks if username matches the regular expression
    if (!regexUsername.test(inputUsername.value)) {
      message += '<p>Username structure:  (3+ chars) + @ + (3+ chars) + "." + (2-3 chars)</p>';
      invalid = true;
    }
    // Checks if password has at least 8 chars
    if (!regexHasEightChars.test(inputPassword.value)) {
      message += '<p>Password needs to contain at least 8 characters</p>';
      invalid = true;
    }

    // Checks if password matches the regular expression
    // if (regexPassword.test(inputPassword.value)) {
    //     message += '<p>Password structure: lenght at least 12, Contains a digit. Contains an uppercase letter.  Contains a lowercase letter.A character not being alphanumeric.</p>';
    // }

    // console.log(invalid);
    output.innerHTML = message;
    return invalid;
  }

  /**
   *  (?=^.{12,}$) - String is >= 12 chars
   (?=.*[0-9]) - Contains a digit
   (?=.*[A-Z]) - Contains an uppercase letter
   (?=.*[a-z]) - Contains a lowercase letter
   (?=.*[^A-Za-z0-9]) - A character not being alphanumeric.
   * */
  function validatePassword() {
    let points = 0;
    // Regex
    const twelfChars = /^(?=^.{12,}$).*$/;
    const containsDigit = /^(?=.*[0-9]).*$/;
    const containsUppercase = /^(?=.*[A-Z]).*$/;
    const containsLowercase = /^(?=.*[a-z]).*$/;
    const alphanumeric = /^(?=.*[^A-Za-z0-9]).*$/;

    // Giving points for matching regex
    if (twelfChars.test(inputPassword.value)) {
      points++;
    }
    if (containsDigit.test(inputPassword.value)) {
      points++;
    }
    if (containsUppercase.test(inputPassword.value)) {
      points++;
    }
    if (containsLowercase.test(inputPassword.value)) {
      points++;
    }
    if (alphanumeric.test(inputPassword.value)) {
      points++;
    }

    // Set Strength
    if (points === 5) {
      setPasswordStrength('strong', 'green');
    } else if (points > 2) {
      setPasswordStrength('medium', 'yellow');
    } else {
      setPasswordStrength('Low', 'red');
    }
  }

  function setPasswordStrength(strenght, color) {
    passwordStrength.innerHTML = 'Password strenght: ' + strenght + '!';
    passwordStrength.style.color = color;
  }

  function checkCalculation() {
    if (calcInput.value == (a + b)) {
      button.style.display = 'inherit';
      calcBox.style.display = 'none';
      alert('Correct!');
    } else {
      button.style.display = 'none';
      calcBox.style.display = 'inherit';
    }
  }
</script>

</html>